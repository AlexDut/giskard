<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-1">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="giskard_users"/>
            </not>
        </preConditions>
        <createTable tableName="giskard_users">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="user_pkey"/>
            </column>
            <column name="email" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
            <column name="hashed_password" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
            <column name="is_active" type="BOOLEAN" defaultValue="true"/>
            <column name="user_id" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
            <column name="display_name" type="VARCHAR"/>
            <column name="role_id" type="INTEGER"/>
        </createTable>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-2">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="role"/>
            </not>
        </preConditions>
        <createTable tableName="role">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="role_pkey"/>
            </column>
            <column name="name" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-3">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="projects"/>
            </not>
        </preConditions>
        <createTable tableName="projects">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="projects_pkey"/>
            </column>
            <column name="name" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR"/>
            <column name="owner_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="created_on" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="key" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-4">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="project_models"/>
            </not>
        </preConditions>
        <createTable tableName="project_models">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="project_models_pkey"/>
            </column>
            <column name="file_name" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
            <column name="location" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
            <column name="python_version" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
            <column name="requirements_file_location" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
            <column name="owner_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="project_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="created_on" type="TIMESTAMP WITH TIME ZONE"/>
        </createTable>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-5">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="datasets"/>
            </not>
        </preConditions>
        <createTable tableName="datasets">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="datasets_pkey"/>
            </column>
            <column name="file_name" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
            <column name="location" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
            <column name="owner_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="project_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="created_on" type="TIMESTAMP WITH TIME ZONE"/>
        </createTable>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-6">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="feedbacks"/>
            </not>
        </preConditions>
        <createTable tableName="feedbacks">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="feedbacks_pkey"/>
            </column>
            <column name="project_id" type="INTEGER"/>
            <column name="model_id" type="INTEGER"/>
            <column name="dataset_id" type="INTEGER"/>
            <column name="user_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="created_on" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="feedback_type" type="VARCHAR">
                <constraints nullable="false"/>
            </column>
            <column name="feature_name" type="VARCHAR"/>
            <column name="feature_value" type="VARCHAR"/>
            <column name="feedback_choice" type="VARCHAR"/>
            <column name="feedback_message" type="VARCHAR"/>
            <column name="user_data" type="JSON">
                <constraints nullable="false"/>
            </column>
            <column name="target_feature" type="VARCHAR"/>
            <column name="original_data" type="JSON">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-7">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="feedback_replies"/>
            </not>
        </preConditions>
        <createTable tableName="feedback_replies">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="feedback_replies_pkey"/>
            </column>
            <column name="feedback_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="reply_to_reply" type="bigint"/>
            <column name="user_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="content" type="VARCHAR"/>
            <column name="created_on" type="TIMESTAMP WITH TIME ZONE"/>
        </createTable>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-8">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="projects_guests"/>
            </not>
        </preConditions>
        <createTable tableName="projects_guests">
            <column name="project_id" type="INTEGER"/>
            <column name="user_id" type="INTEGER"/>
        </createTable>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-9">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="ix_user_email"/>
            </not>
        </preConditions>
        <createIndex indexName="ix_user_email" tableName="giskard_users" unique="true">
            <column name="email"/>
        </createIndex>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-10">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="ix_user_user_id"/>
            </not>
        </preConditions>
        <createIndex indexName="ix_user_user_id" tableName="giskard_users" unique="true">
            <column name="user_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-11">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="datasets_owner_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="owner_id" baseTableName="datasets"
                                 constraintName="datasets_owner_id_fkey" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="giskard_users" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-12">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="feedback_replies_user_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="feedback_replies"
                                 constraintName="feedback_replies_user_id_fkey" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" referencedTableName="giskard_users" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-13">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="feedbacks_user_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="feedbacks"
                                 constraintName="feedbacks_user_id_fkey" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="giskard_users" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-14">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="project_models_owner_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="owner_id" baseTableName="project_models"
                                 constraintName="project_models_owner_id_fkey" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" referencedTableName="giskard_users" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-15">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="projects_guests_user_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="projects_guests"
                                 constraintName="projects_guests_user_id_fkey" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" referencedTableName="giskard_users" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-16">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="projects_owner_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="owner_id" baseTableName="projects"
                                 constraintName="projects_owner_id_fkey" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="giskard_users" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-17">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="user_role_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="role_id" baseTableName="giskard_users" constraintName="user_role_id_fkey"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" referencedTableName="role" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-18">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="ix_projects_key"/>
            </not>
        </preConditions>
        <createIndex indexName="ix_projects_key" tableName="projects" unique="true">
            <column name="key"/>
        </createIndex>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-19">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="datasets_project_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="project_id" baseTableName="datasets"
                                 constraintName="datasets_project_id_fkey" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="projects" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-20">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="feedbacks_project_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="project_id" baseTableName="feedbacks"
                                 constraintName="feedbacks_project_id_fkey" deferrable="false" initiallyDeferred="false"
                                 onDelete="SET NULL" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="projects" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-21">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="project_models_project_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="project_id" baseTableName="project_models"
                                 constraintName="project_models_project_id_fkey" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" referencedTableName="projects" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-22">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="projects_guests_project_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="project_id" baseTableName="projects_guests"
                                 constraintName="projects_guests_project_id_fkey" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" referencedTableName="projects" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-23">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="ix_project_models_file_name"/>
            </not>
        </preConditions>
        <createIndex indexName="ix_project_models_file_name" tableName="project_models">
            <column name="file_name"/>
        </createIndex>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-24">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="feedbacks_model_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="model_id" baseTableName="feedbacks"
                                 constraintName="feedbacks_model_id_fkey" deferrable="false" initiallyDeferred="false"
                                 onDelete="SET NULL" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="project_models" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-25">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="ix_datasets_file_name"/>
            </not>
        </preConditions>
        <createIndex indexName="ix_datasets_file_name" tableName="datasets">
            <column name="file_name"/>
        </createIndex>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-26">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="feedbacks_dataset_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="dataset_id" baseTableName="feedbacks"
                                 constraintName="feedbacks_dataset_id_fkey" deferrable="false" initiallyDeferred="false"
                                 onDelete="SET NULL" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="datasets" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-27">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="ix_feedbacks_model_id"/>
            </not>
        </preConditions>
        <createIndex indexName="ix_feedbacks_model_id" tableName="feedbacks">
            <column name="model_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-28">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="ix_feedbacks_project_id"/>
            </not>
        </preConditions>
        <createIndex indexName="ix_feedbacks_project_id" tableName="feedbacks">
            <column name="project_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-29">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="ix_feedbacks_feedback_type"/>
            </not>
        </preConditions>
        <createIndex indexName="ix_feedbacks_feedback_type" tableName="feedbacks">
            <column name="feedback_type"/>
        </createIndex>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-30">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="ix_feedbacks_dataset_id"/>
            </not>
        </preConditions>
        <createIndex indexName="ix_feedbacks_dataset_id" tableName="feedbacks">
            <column name="dataset_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-31">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="feedback_replies_feedback_id_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="feedback_id" baseTableName="feedback_replies"
                                 constraintName="feedback_replies_feedback_id_fkey" deferrable="false"
                                 initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="id" referencedTableName="feedbacks" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-32">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="ix_feedback_replies_feedback_id"/>
            </not>
        </preConditions>
        <createIndex indexName="ix_feedback_replies_feedback_id" tableName="feedback_replies">
            <column name="feedback_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-33">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="ix_feedback_replies_reply_to_reply"/>
            </not>
        </preConditions>
        <createIndex indexName="ix_feedback_replies_reply_to_reply" tableName="feedback_replies">
            <column name="reply_to_reply"/>
        </createIndex>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-34">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="feedback_replies_reply_to_reply_fkey"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="reply_to_reply" baseTableName="feedback_replies"
                                 constraintName="feedback_replies_reply_to_reply_fkey" deferrable="false"
                                 initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="id" referencedTableName="feedback_replies" validate="true"/>
    </changeSet>
    <changeSet author="andreyavtomonov (generated)" id="1648855574756-35">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="alembic_version"/>
            </not>
        </preConditions>
        <createTable tableName="alembic_version">
            <column name="version_num" type="VARCHAR(32)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="alembic_version_pkc"/>
            </column>
        </createTable>
    </changeSet>
</databaseChangeLog>
