title: Data drift
id: data_drift
order: 4
items:
  - id: drift_psi
    title: Categorical Drift (Population Stability Index)
    hint : Test if a categorical variable is drifting between two datasets with PSI score
    # language=Python
    code: |
      """
        Summary: Test if a categorical variable is drifting between two datasets with PSI score

        Description: Test if the PSI score between the actual and expected datasets is below the threshold for
        a given categorical feature

        Example : The test is passed when the  PSI score of gender between train and test sets is below 0.2

        Args:
            expected_series(pandas.core.frame.DataFrame):
                a categorical column in train dataset
            actual_series(pandas.core.frame.DataFrame):
                categorical column in test dataset that is compared to var_expected
            threshold:
                threshold value for PSI

        Returns:
            metric:
                the total psi score between the actual and expected datasets
            passed:
                TRUE if total_psi <= threshold
      """
      tests.drift.test_drift_psi(
          expected_series=train_df.df['{{CATEGORICAL FEATURE NAME}}'],
          actual_series=test_df.df['{{CATEGORICAL FEATURE NAME}}'],
          threshold=0.2
      )
  - id: drift_chi_square
    title: Categorical drift (Chi-squared)
    hint : Test if a categorical variable is drifting between two datasets with the chi square
    # language=Python
    code: |
      """
        Summary: Test if a categorical variable is drifting between two datasets with the chi square

        Description: Test if the p-value of the chi square test between the actual and expected datasets is
        above the threshold for a given categorical feature

        Example : The test is passed when the pvalue of the chi square test of the categorical variable between
        train and test sets is higher than 0.05. It means that chi square test cannot be rejected at 5% level
        and that we cannot assume drift for this variable.

        Args:
            expected_series(pandas.core.frame.DataFrame):
                a categorical column in train dataset
            actual_series(pandas.core.frame.DataFrame):
                categorical column in test dataset that is compared to var_expected
            threshold:
                threshold for p-value of chi-square

        Returns:
            chi_square:
            the chi_square statistics of the test. The higher the chi quare, the higher the drift

            metric: the pvalue of chi square test

            passed:
                TRUE if metric > threshold
      """
      tests.drift.test_drift_chi_square(
          expected_series=train_df.df['{{CATEGORICAL FEATURE NAME}}'],
          actual_series=test_df.df['{{CATEGORICAL FEATURE NAME}}'],
          threshold=0.05
      )
  - id: drift_ks
    title: Numerical drift (Kolmogorov-Smirnov)
    hint : Test if a numerical variable is drifting between two datasets with the Komogorov-Smirnov test
    # language=Python
    code: |
      """
        Summary: Test if a numerical variable is drifting between two datasets with the Komogorov-Smirnov test

        Description:Test if the pvalue of the KS test between the actual and expected datasets is above
        the threshold for a given numerical feature

        Example : The test is passed when the pvalue of the KS test of the numerical variable
        between the actual and expected datasets is higher than 0.05. It means that the KS test
        cannot be rejected at 5% level and that we cannot assume drift for this variable.

        Args:
            expected_series(pandas.core.frame.DataFrame):
                a categorical column in train dataset
            actual_series(pandas.core.frame.DataFrame):
                categorical column in test dataset that is compared to var_expected
            threshold:
                threshold for p-value of KS test
            max_categories:
                maxiumum number of modalities

        Returns:
            KS_statistics :
            the KS statistics of the test. The higher the value, the higher the drift

            metric:
                the pvalue of KS test

            passed:
                TRUE if metric > threshold
      """
      tests.drift.test_drift_ks(
          expected_series=train_df.df['{{NUMERIC FEATURE NAME}}'],
          actual_series=test_df.df['{{NUMERIC FEATURE NAME}}'],
          threshold=0.05
      )
  - id: drift_earth_movers_distance
    title: Numerical drift (Earth moverâ€™s distance)
    hint : Test if a numerical variable is drifting between two datasets with the Earth Movers Distance test
    # language=Python
    code: |
      """
        Summary: Test if a numerical variable is drifting between two datasets with the Earth Movers Distance test

        Description: Test if the earth movers distance between the actual and expected datasets is
        below the threshold for a given numerical feature

        Example : The test is passed when the earth movers distance of the numerical
         variable between the actual and expected datasets is lower than 0.1.
         It means that we cannot assume drift for this variable.

        Args:
            expected_series(pandas.core.frame.DataFrame):
                a categorical column in train dataset
            actual_series(pandas.core.frame.DataFrame):
                categorical column in test dataset that is compared to var_expected
            threshold:
                threshold for p-value of earth movers distance

        Returns:
            metric:
                the earth movers distance

            passed:
                TRUE if metric < threshold
      """
      tests.drift.test_drift_earth_movers_distance(
          expected_series=train_df.df['{{NUMERIC FEATURE NAME}}'],
          actual_series=test_df.df['{{NUMERIC FEATURE NAME}}'],
          threshold=0.02
      )
